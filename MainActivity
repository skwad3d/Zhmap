package com.example.heightmapapp

import android.graphics.Bitmap
import android.graphics.Canvas
import android.graphics.Color
import android.graphics.Paint
import android.os.Bundle
import android.widget.Button
import android.widget.Toast
import androidx.appcompat.app.AppCompatActivity
import java.io.BufferedReader
import java.io.InputStreamReader
import java.io.FileInputStream
import java.io.FileOutputStream
import android.content.Intent
import android.net.Uri
import android.os.Environment
import java.io.File

class MainActivity : AppCompatActivity() {

    private val PICK_OBJ_FILE = 1

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        val pickButton = Button(this).apply {
            text = "Load OBJ"
            setOnClickListener { pickObjFile() }
        }
        setContentView(pickButton)
    }

    private fun pickObjFile() {
        val intent = Intent(Intent.ACTION_GET_CONTENT).apply {
            type = "*/*"
        }
        startActivityForResult(intent, PICK_OBJ_FILE)
    }

    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
        super.onActivityResult(requestCode, resultCode, data)

        if (requestCode == PICK_OBJ_FILE && resultCode == RESULT_OK) {
            data?.data?.let { uri ->
                val inputStream = contentResolver.openInputStream(uri)
                inputStream?.let {
                    val vertices = parseObj(it)
                    val bitmap = createHeightMap(vertices, 512, 512)
                    saveBitmap(bitmap)
                }
            }
        }
    }
}
